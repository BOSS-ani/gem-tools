<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>コンテンツ制作ツールハブ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto-Sans-JP', sans-serif;
            background-color: #111827;
            color: #F3F4F6;
        }
        .nav-button {
            background-color: #374151;
            color: #D1D5DB;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 700;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .nav-button:hover {
            background-color: #4B5563;
        }
        .nav-button.active {
            background-color: #1F2937;
            color: #4F46E5;
            border-color: #4F46E5;
        }
        .tool-container {
            display: none;
        }
        .tool-container.active {
            display: block;
        }
        .step-card {
            background-color: #1F2937;
            border: 1px solid #374151;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .step-number {
            background-color: #4F46E5;
            color: white;
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        .main-button {
            background-color: #4F46E5;
            color: white;
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .main-button:hover {
            background-color: #4338CA;
        }
        .form-input, textarea {
            background-color: #374151;
            border: 1px solid #4B5563;
            border-radius: 0.5rem;
            color: #F3F4F6;
            padding: 0.75rem;
        }
        .form-input:focus, textarea:focus {
            outline: none;
            border-color: #4F46E5;
            box-shadow: 0 0 0 2px #4F46E5;
        }
        .form-checkbox {
            background-color: #374151;
            border-color: #4B5563;
        }
        .form-checkbox:checked {
            background-color: #4F46E5;
        }
        .loader {
            width: 20px;
            height: 20px;
            border: 3px solid #4B5563;
            border-top-color: #F3F4F6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        audio::-webkit-media-controls-panel { background-color: #374151; }
        audio::-webkit-media-controls-play-button,
        audio::-webkit-media-controls-volume-slider,
        audio::-webkit-media-controls-mute-button { filter: invert(1); }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-500">
                コンテンツ制作ツールハブ
            </h1>
            <p class="text-gray-400 mt-2">AIを活用したツールで制作ワークフローを加速させます。</p>
        </header>

        <!-- Navigation -->
        <nav class="flex flex-wrap justify-center gap-4 mb-10">
            <button id="nav-narration" class="nav-button" data-tool="narration">AIナレーション</button>
            <button id="nav-splitter" class="nav-button" data-tool="splitter">音声分割</button>
            <button id="nav-prompt" class="nav-button" data-tool="prompt">プロンプト生成</button>
            <button id="nav-content" class="nav-button" data-tool="content">コンテンツ生成</button>
        </nav>

        <!-- Tool: AI Narration Assistant -->
        <div id="narration-tool" class="tool-container">
             <!-- ... existing narration tool code ... -->
        </div>
        
        <!-- Tool: Audio Splitter -->
        <div id="splitter-tool" class="tool-container">
             <!-- ... existing splitter tool placeholder ... -->
        </div>

        <!-- Tool: Prompt Generator -->
        <div id="prompt-tool" class="tool-container">
            <!-- ... existing prompt generator code ... -->
        </div>

        <!-- Tool: Content Generator -->
        <div id="content-tool" class="tool-container">
            <h2 class="text-2xl font-bold text-center mb-6">汎用コンテンツ生成プロンプト</h2>
            <!-- Step 1 -->
            <div class="step-card">
                <div class="flex items-start gap-4">
                    <div class="step-number">1</div>
                    <div>
                        <h3 class="text-xl font-bold mb-2">入力セクション</h3>
                        <p class="text-gray-400 mb-4">分析テーマと元となるデータを入力してください。</p>
                        <div class="space-y-4">
                            <div>
                                <label for="content-theme" class="block text-sm font-medium text-gray-300 mb-1">分析テーマ</label>
                                <input type="text" id="content-theme" class="w-full form-input" placeholder="例：ローズステークス 2025 期待値徹底分析">
                            </div>
                            <div>
                                <label for="content-data" class="block text-sm font-medium text-gray-300 mb-1">分析データ (テキスト)</label>
                                <textarea id="content-data" class="w-full h-64 text-sm" placeholder="レース概要、コース分析、血統分析、有力馬評価などを入力..."></textarea>
                            </div>
                        </div>
                         <button id="generate-content-btn" class="main-button mt-4">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                            <span>全コンテンツを生成</span>
                        </button>
                    </div>
                </div>
            </div>
            <!-- Step 2 -->
            <div id="content-result-section" class="step-card hidden">
                <div class="flex items-start gap-4">
                    <div class="step-number">2</div>
                    <div>
                        <h3 class="text-xl font-bold mb-2">出力セクション</h3>
                        <p class="text-gray-400 mb-4">AIによって生成された各種コンテンツです。</p>
                        <div class="space-y-6">
                             <div>
                                <h4 class="text-lg font-bold mb-2 text-indigo-400">グラフ用データ (JSON)</h4>
                                <textarea id="content-json-output" class="w-full h-48 text-xs" readonly></textarea>
                            </div>
                             <div>
                                <h4 class="text-lg font-bold mb-2 text-indigo-400">ナレーション原稿</h4>
                                <textarea id="content-script-output" class="w-full h-48 text-sm" readonly></textarea>
                            </div>
                             <div>
                                <h4 class="text-lg font-bold mb-2 text-indigo-400">概要テキスト</h4>
                                <textarea id="content-summary-output" class="w-full h-32 text-sm" readonly></textarea>
                            </div>
                            <div>
                                <h4 class="text-lg font-bold mb-2 text-indigo-400">ウェブコンテンツ (HTML)</h4>
                                <p class="text-gray-400 mb-2 text-sm">下のボタンをクリックすると、生成されたHTMLを新しいタブでプレビューします。</p>
                                 <button id="preview-html-btn" class="main-button">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                                    <span>HTMLをプレビュー</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>

     <div id="loader-container" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <!-- ... loader element ... -->
    </div>

<script>
    const handleRouting = () => {
        document.querySelectorAll('.tool-container').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-button').forEach(el => el.classList.remove('active'));

        const hash = window.location.hash.slice(1);
        const params = new URLSearchParams(hash);
        let tool = params.get('tool');
        
        if (!['narration', 'splitter', 'prompt', 'content'].includes(tool)) {
            tool = 'narration'; // Default to a valid tool
        }

        const targetToolEl = document.getElementById(`${tool}-tool`);
        const targetNavEl = document.getElementById(`nav-${tool}`);

        if (targetToolEl) {
            targetToolEl.classList.add('active');
            if (targetNavEl) {
                targetNavEl.classList.add('active');
            }
        }
    };
    
    document.addEventListener('DOMContentLoaded', () => {
        // --- All existing JS code for other tools is here ---
        
        // --- Content Generator ---
        const contentThemeInput = document.getElementById('content-theme');
        const contentDataInput = document.getElementById('content-data');
        const generateContentBtn = document.getElementById('generate-content-btn');
        const contentResultSection = document.getElementById('content-result-section');
        const contentJsonOutput = document.getElementById('content-json-output');
        const contentScriptOutput = document.getElementById('content-script-output');
        const contentSummaryOutput = document.getElementById('content-summary-output');
        const previewHtmlBtn = document.getElementById('preview-html-btn');
        let generatedHtmlContent = '';

        generateContentBtn.addEventListener('click', async () => {
            const theme = contentThemeInput.value.trim();
            const data = contentDataInput.value.trim();
            if (!theme || !data) {
                alert('分析テーマと分析データの両方を入力してください。');
                return;
            }

            showLoader('全コンテンツを生成中...');

            const userPrompt = `
あなたは、専門的な分析コンテンツを、ウェブ、テキスト、音声概要の3つの形式でアウトプットするAIアシスタントです。以下の入力情報に基づいて、指定された形式で出力を作成してください。

【入力セクション】
1. 分析テーマ:
${theme}

2. 分析データ (テキスト):
${data}

3. グラフ用データ (JSON形式) の自動生成:
2. 分析データ (テキスト):の内容を解析し、必要に応じてウェブ検索で補足的な統計データ（例：血統のシェア、コースの枠順有利不利の具体的な数値など）を収集してください。その上で、以下のJSON構造に従ってグラフ用のデータをあなた自身で生成してください。
- doughnutChart: 分析データ内の主要な要素の割合を示してください。（例：血統の割合など）
- bubbleChart: 分析データに登場する複数の比較対象（例：有力馬）を、2つの軸（例：瞬発力、スタミナ）とサイズ（例：期待度）で評価し、数値化してください。
- barChart: 分析データ内のカテゴリ別データを示してください。（例：枠順別データなど）

【出力セクション】
あなたは以下の全ての項目を単一のJSONオブジェクトとして出力しなければなりません。

{
  "graphData": {
    "doughnutChart": { "title": "【ここにグラフタイトル】", "labels": ["【要素1】", "【要素2】", "【その他】"], "data": ["[数値1]", "[数値2]", "[数値3]"] },
    "bubbleChart": { "title": "【ここにグラフタイトル】", "datasets": [ { "label": "【対象A】", "data": [{"x": "[X軸の値]", "y": "[Y軸の値]", "r": "[サイズ]"}] }, { "label": "【対象B】", "data": [{"x": "[X軸の値]", "y": "[Y軸の値]", "r": "[サイズ]"}] } ], "xLabel": "【X軸ラベル】", "yLabel": "【Y軸ラベル】" },
    "barChart": { "title": "【ここにグラフタイトル】", "labels": ["【カテゴリ1】", "【カテゴリ2】", "【カテゴリ3】", "【カテゴリ4】"], "data": ["[数値1]", "[数値2]", "[数値3]", "[数値4]"], "label": "【データラベル】" }
  },
  "webContent": "ここに、入力された情報に基づき、rose_stakes_2025.htmlのモダンで視覚的なデザインを踏襲した、縦スクロール形式の単一HTMLファイルを生成してください。すべてのCSSとJavaScriptはHTMLファイル内に含めてください。",
  "narrationScript": "ここに、入力情報を基に、約1分半で読める、聴き手を引き込むようなナレーション原稿を作成してください。final_audio_script.mdの構成（導入→本題→結論→締め）と語り口を参考にしてください。",
  "summaryText": "ここに、コンテンツ全体の要点を箇条書きで簡潔にまとめたサマリーテキストを作成してください。"
}
`;
            
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: userPrompt }] }],
                tools: [{"google_search": {}}],
                generationConfig: {
                    responseMimeType: "application/json",
                }
            };

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { throw new Error(`API Error: ${response.status}`); }
                const result = await response.json();
                const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!jsonText) { throw new Error("APIから有効な応答がありませんでした。"); }
                
                const parsedData = JSON.parse(jsonText);
                
                contentJsonOutput.value = JSON.stringify(parsedData.graphData, null, 2);
                contentScriptOutput.value = parsedData.narrationScript;
                contentSummaryOutput.value = parsedData.summaryText;
                generatedHtmlContent = parsedData.webContent;

                contentResultSection.classList.remove('hidden');

            } catch (error) {
                console.error("Error generating content:", error);
                alert(`コンテンツの生成中にエラーが発生しました: ${error.message}`);
            } finally {
                hideLoader();
            }
        });

        previewHtmlBtn.addEventListener('click', () => {
            if (generatedHtmlContent) {
                const previewWindow = window.open();
                previewWindow.document.write(generatedHtmlContent);
                previewWindow.document.close();
            } else {
                alert('プレビューするHTMLコンテンツがありません。');
            }
        });

        // --- Initial Setup ---
        handleRouting();
        window.addEventListener('hashchange', handleRouting);
    });
</script>
</body>
</html>

